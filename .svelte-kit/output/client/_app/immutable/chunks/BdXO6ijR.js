import{_ as Qe}from"./C1FmrZbK.js";import{c as ye,l as xe}from"./Cexvm7jw.js";import{p as _e,J as o,c as Ze,f as $e,a as L,b as E,d as we,e as a,r,g as u,n as pe,i as X,j as Q,F as k,l as V,C as je,bf as et,D as A,E as q,v as tt,k as e,O as qe,I as v,G as Ie,bg as Re,P as at,N as ve,t as rt,H as nt,bh as st,K as He}from"./CHEZFaFW.js";import{a as K}from"./4_OcRqll.js";import{i as Z}from"./V_zUl8LG.js";import{e as it}from"./BcIZtQ9e.js";import{c as O,g as De,s as Me,r as he}from"./ClU6btJJ.js";import{b as Ke}from"./ciwQe6zK.js";import{p as te}from"./B_gnReGI.js";import{v as me,a as lt}from"./CIXHlwB2.js";import{l as Te}from"./CWob9Ii1.js";import{b as fe,a as Ve}from"./DGVqiR9F.js";be[k]="src/lib/components/ChatMessage.svelte";var ot=K(V('<div class="flex justify-end"><div class="max-w-xs lg:max-w-md"><div><p class="text-sm whitespace-pre-wrap"> </p></div> <div class="flex justify-end items-center mt-1 space-x-2"><span> </span> <div class="w-6 h-6 rounded-full bg-gray-400 flex items-center justify-center text-white text-xs"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg></div></div></div></div>'),be[k],[[20,2,[[21,4,[[22,6,[[25,8]]],[27,6,[[28,8],[33,8,[[34,10,[[35,12]]]]]]]]]]]]),dt=K(V('<div class="flex"><div class="flex-shrink-0 mr-3"><div><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path></svg></div></div> <div class="max-w-xs lg:max-w-md"><div class="flex items-center mb-1"><span> </span></div> <div><p class="text-sm whitespace-pre-wrap"> </p></div> <div class="flex items-center mt-1"><span> </span></div></div></div>'),be[k],[[42,2,[[43,4,[[44,6,[[47,8,[[48,10]]]]]]],[53,4,[[54,6,[[55,8]]],[62,6,[[67,8]]],[72,6,[[73,8]]]]]]]]);function be(P,i){ye(new.target),_e(i,!0,be);let l=te(i,"theme",3,"light");o(i.message.senderType,"bot");const x=o(i.message.senderType,"visitor");function s(g){return new Date(g).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}var w=Ze(),d=$e(w);{var T=g=>{var p=ot(),b=a(p),c=a(b);let y;var D=a(c),S=a(D,!0);r(D),r(c);var R=u(c,2),I=a(R);let Y;var j=a(I,!0);r(I),pe(2),r(R),r(b),r(p),X((G,N,ae)=>{var re,$;y=O(c,1,"px-4 py-2 rounded-lg text-white",null,y,G),De(c,($=(re=i.tenant)==null?void 0:re.branding)!=null&&$.primaryColor?`background-color: ${i.tenant.branding.primaryColor}`:""),Q(S,i.message.content),Y=O(I,1,"text-xs",null,Y,N),Q(j,ae)},[()=>{var G,N;return{"bg-blue-600":!((N=(G=i.tenant)==null?void 0:G.branding)!=null&&N.primaryColor)}},()=>({"text-gray-400":o(l(),"dark"),"text-gray-500":o(l(),"light")}),()=>s(i.message.sentAt)]),E(g,p)},F=g=>{var p=dt(),b=a(p),c=a(b);let y;r(b);var D=u(b,2),S=a(D),R=a(S);let I;var Y=a(R,!0);r(R),r(S);var j=u(S,2);let G;var N=a(j),ae=a(N,!0);r(N),r(j);var re=u(j,2),$=a(re);let U;var de=a($,!0);r($),r(re),r(D),r(p),X((se,ie,ce,ge,ue)=>{var W,le,ne,oe;y=O(c,1,"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium",null,y,se),De(c,(le=(W=i.tenant)==null?void 0:W.branding)!=null&&le.primaryColor?`background-color: ${i.tenant.branding.primaryColor}`:""),I=O(R,1,"text-sm font-medium",null,I,ie),Q(Y,((oe=(ne=i.tenant)==null?void 0:ne.branding)==null?void 0:oe.companyName)||"Legal Assistant"),G=O(j,1,"px-4 py-2 rounded-lg",null,G,ce),Q(ae,i.message.content),U=O($,1,"text-xs",null,U,ge),Q(de,ue)},[()=>{var se,ie;return{"bg-blue-600":!((ie=(se=i.tenant)==null?void 0:se.branding)!=null&&ie.primaryColor)}},()=>({"text-gray-300":o(l(),"dark"),"text-gray-700":o(l(),"light")}),()=>({"bg-gray-700":o(l(),"dark"),"text-gray-100":o(l(),"dark"),"bg-gray-100":o(l(),"light"),"text-gray-900":o(l(),"light")}),()=>({"text-gray-400":o(l(),"dark"),"text-gray-500":o(l(),"light")}),()=>s(i.message.sentAt)]),E(g,p)};L(()=>Z(d,g=>{x?g(T):g(F,!1)}),"if",be,19,0)}return E(P,w),we({...xe()})}Ae[k]="src/lib/components/MessageInput.svelte";function ct(P,i){o(P.key,"Enter")&&!P.shiftKey&&(P.preventDefault(),i())}var ut=K(V('<div><div class="flex space-x-2"><textarea rows="1" aria-label="Message input" style="max-height: 120px; overflow-y: auto;"></textarea> <button aria-label="Send message"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button></div></div>'),Ae[k],[[48,0,[[51,2,[[52,4],[71,4,[[81,6,[[82,8]]]]]]]]]]);function Ae(P,i){ye(new.target),_e(i,!0,Ae);let l=te(i,"disabled",3,!1),x=te(i,"theme",3,"light"),s=te(i,"placeholder",3,"Type your message...");const w=et();let d=A(q(""),"message"),T;function F(){e(d).trim()&&!l()&&(w("send",e(d).trim()),v(d,""),g())}function g(){T&&(T.style.height="auto",T.style.height=Math.min(T.scrollHeight,120)+"px")}tt(()=>{e(d)&&g()});var p=ut();let b;var c=a(p),y=a(c);qe(y),y.__keydown=[ct,F],y.__input=g;let D;Ke(y,j=>T=j,()=>T);var S=u(y,2);S.__click=F;let R;var I=a(S),Y=a(I);return Me(Y,"stroke-width",2),r(I),r(S),r(c),r(p),X((j,G,N)=>{b=O(p,1,"p-4 border-t",null,b,j),Me(y,"placeholder",s()),y.disabled=l(),D=O(y,1,"flex-1 resize-none rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border",null,D,G),S.disabled=l(),R=O(S,1,"px-4 py-2 rounded-lg text-white font-medium transition-colors",null,R,N)},[()=>({"border-gray-200":o(x(),"light"),"border-gray-700":o(x(),"dark")}),()=>({"bg-white":o(x(),"light"),"text-gray-900":o(x(),"light"),"border-gray-300":o(x(),"light"),"bg-gray-800":o(x(),"dark"),"text-gray-100":o(x(),"dark"),"border-gray-600":o(x(),"dark")}),()=>({"bg-blue-600":!l(),"hover:bg-blue-700":!l(),"bg-gray-400":l(),"cursor-not-allowed":l()})]),fe(y,()=>e(d),j=>v(d,j)),E(P,p),we({...xe()})}je(["keydown","input","click"]);Se[k]="src/lib/components/TypingIndicator.svelte";var mt=K(V('<div class="flex items-center space-x-3 svelte-cigvlm"><div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-medium svelte-cigvlm"><svg class="w-5 h-5 svelte-cigvlm" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd" class="svelte-cigvlm"></path></svg></div> <div class="max-w-xs lg:max-w-md svelte-cigvlm"><div><div class="flex items-center space-x-2 svelte-cigvlm"><span> </span> <div class="typing-dots flex space-x-1 items-center h-4 svelte-cigvlm"><div class="typing-dot typing-dot-1 w-2 h-2 bg-blue-500 rounded-full svelte-cigvlm"></div> <div class="typing-dot typing-dot-2 w-2 h-2 bg-blue-500 rounded-full svelte-cigvlm"></div> <div class="typing-dot typing-dot-3 w-2 h-2 bg-blue-500 rounded-full svelte-cigvlm"></div></div></div></div></div></div>'),Se[k],[[13,0,[[14,2,[[15,4,[[16,6]]]]],[20,2,[[21,4,[[26,6,[[27,8],[32,8,[[33,10],[34,10],[35,10]]]]]]]]]]]]);function Se(P,i){ye(new.target),_e(i,!0,Se);let l=te(i,"user",3,"Legal Assistant"),x=te(i,"theme",3,"light");var s=mt(),w=u(a(s),2),d=a(w);let T;var F=a(d),g=a(F);let p;var b=a(g);return r(g),pe(2),r(F),r(d),r(w),r(s),X((c,y)=>{T=O(d,1,"px-4 py-3 rounded-lg svelte-cigvlm",null,T,c),p=O(g,1,"text-sm svelte-cigvlm",null,p,y),Q(b,`${l()??""} is typing`)},[()=>({"bg-gray-700":o(x(),"dark"),"text-gray-100":o(x(),"dark"),"bg-gray-100":o(x(),"light"),"text-gray-900":o(x(),"light")}),()=>({"text-gray-300":o(x(),"dark"),"text-gray-600":o(x(),"light")})]),E(P,s),we({...xe()})}B[k]="src/lib/components/ContactForm.svelte";var vt=K(V('<p class="text-red-500 text-xs mt-1"> </p>'),B[k],[[114,8]]),gt=K(V('<p class="text-red-500 text-xs mt-1"> </p>'),B[k],[[128,8]]),ft=K(V('<p class="text-red-500 text-xs mt-1"> </p>'),B[k],[[142,8]]),pt=K(V('<p class="text-red-500 text-xs mt-1"> </p>'),B[k],[[156,8]]),bt=K(V('<span class="flex items-center justify-center"><svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Submitting...</span>'),B[k],[[192,10,[[193,12,[[194,14],[195,14]]]]]]),ht=K(V(`<div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md mx-auto"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-gray-900">Request Consultation</h3> <button class="text-gray-400 hover:text-gray-500" aria-label="Close form"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div> <p class="text-sm text-gray-600 mb-4">Please provide your contact details and we'll have an attorney reach out to you shortly.</p> <form class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label> <input type="text" id="name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Your full name"/> <!></div> <div><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label> <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Your email address"/> <!></div> <div><label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Your phone number"/> <!></div> <div><label for="enquiryDetails" class="block text-sm font-medium text-gray-700 mb-1">Legal Matter Details *</label> <textarea id="enquiryDetails" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Please describe your legal matter (e.g., accident details, what happened, when it occurred, injuries sustained, etc.)"></textarea> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Preferred Contact Method *</label> <div class="flex space-x-4"><label class="flex items-center"><input type="radio" class="mr-2"/> <span class="text-sm">Email</span></label> <label class="flex items-center"><input type="radio" class="mr-2"/> <span class="text-sm">Phone</span></label></div></div> <div><label for="message" class="block text-sm font-medium text-gray-700 mb-1">Additional Message (Optional)</label> <textarea id="message" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Briefly describe your legal matter..."></textarea></div> <div class="flex space-x-3"><button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <button type="button" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500">Cancel</button></div></form> <p class="text-xs text-gray-500 mt-4">By submitting this form, you agree to our privacy policy and terms of service.</p></div>`),B[k],[[85,0,[[86,2,[[87,4],[88,4,[[89,6,[[90,8]]]]]]],[99,2],[103,2,[[104,4,[[105,6],[106,6]]],[118,4,[[119,6],[120,6]]],[132,4,[[133,6],[134,6]]],[146,4,[[147,6],[148,6]]],[160,4,[[161,6],[162,6,[[163,8,[[164,10],[165,10]]],[167,8,[[168,10],[169,10]]]]]]],[174,4,[[175,6],[176,6]]],[185,4,[[186,6],[207,6]]]]],[217,2]]]]);function B(P,i){ye(new.target),_e(i,!0,B);const l=[];let x=te(i,"initialEnquiry",3,""),s=A(q(Ie({name:"",email:"",phone:"",preferredContact:"email",enquiryDetails:x(),message:""})),"formData"),w=A(q(!1),"isSubmitting"),d=A(q(Ie({})),"errors");function T(){return v(d,{},!0),e(s).name.trim()||(e(d).name="Name is required"),e(s).email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e(s).email)||(e(d).email="Please enter a valid email address"):e(d).email="Email is required",e(s).phone.trim()?/^(\+?27|0)[0-9]{9}$/.test(e(s).phone.replace(/\s/g,""))||(e(d).phone="Please enter a valid South African phone number"):e(d).phone="Phone number is required",e(s).enquiryDetails.trim()||(e(d).enquiryDetails="Please describe your legal matter"),o(Object.keys(e(d)).length,0)}async function F(t){if(t.preventDefault(),!!T()){v(w,!0);try{(await ve(i.onSubmit(e(s))))(),v(s,{name:"",email:"",phone:"",preferredContact:"email",enquiryDetails:"",message:""},!0)}catch(f){console.error(...Te("error","Error submitting form:",f))}finally{v(w,!1)}}}var g=ht(),p=a(g),b=u(a(p),2);b.__click=function(...t){Re(()=>i.onClose,this,t,B,[88,21])},r(p);var c=u(p,4),y=a(c),D=u(a(y),2);he(D),me("bind:value={formData.name}",()=>e(s),()=>"name",109,8);var S=u(D,2);{var R=t=>{var f=vt(),J=a(f,!0);r(f),X(()=>Q(J,e(d).name)),E(t,f)};L(()=>Z(S,t=>{e(d).name&&t(R)}),"if",B,113,6)}r(y);var I=u(y,2),Y=u(a(I),2);he(Y),me("bind:value={formData.email}",()=>e(s),()=>"email",123,8);var j=u(Y,2);{var G=t=>{var f=gt(),J=a(f,!0);r(f),X(()=>Q(J,e(d).email)),E(t,f)};L(()=>Z(j,t=>{e(d).email&&t(G)}),"if",B,127,6)}r(I);var N=u(I,2),ae=u(a(N),2);he(ae),me("bind:value={formData.phone}",()=>e(s),()=>"phone",137,8);var re=u(ae,2);{var $=t=>{var f=ft(),J=a(f,!0);r(f),X(()=>Q(J,e(d).phone)),E(t,f)};L(()=>Z(re,t=>{e(d).phone&&t($)}),"if",B,141,6)}r(N);var U=u(N,2),de=u(a(U),2);qe(de),me("bind:value={formData.enquiryDetails}",()=>e(s),()=>"enquiryDetails",150,8);var se=u(de,2);{var ie=t=>{var f=pt(),J=a(f,!0);r(f),X(()=>Q(J,e(d).enquiryDetails)),E(t,f)};L(()=>Z(se,t=>{e(d).enquiryDetails&&t(ie)}),"if",B,155,6)}r(U);var ce=u(U,2),ge=u(a(ce),2),ue=a(ge),W=a(ue);he(W),me("bind:group={formData.preferredContact}",()=>e(s),()=>"preferredContact",164,30),W.value=W.__value="email",pe(2),r(ue);var le=u(ue,2),ne=a(le);he(ne),me("bind:group={formData.preferredContact}",()=>e(s),()=>"preferredContact",168,30),ne.value=ne.__value="phone",pe(2),r(le),r(ge),r(ce);var oe=u(ce,2),Ce=u(a(oe),2);qe(Ce),me("bind:value={formData.message}",()=>e(s),()=>"message",178,8),r(oe);var n=u(oe,2),m=a(n),_=a(m);{var H=t=>{var f=bt();E(t,f)},C=t=>{var f=rt("Submit Request");E(t,f)};L(()=>Z(_,t=>{e(w)?t(H):t(C,!1)}),"if",B,191,8)}r(m);var M=u(m,2);return M.__click=function(...t){Re(()=>i.onClose,this,t,B,[209,17])},r(n),r(c),pe(2),r(g),X(()=>m.disabled=e(w)),at("submit",c,F),fe(D,()=>e(s).name,t=>e(s).name=t),fe(Y,()=>e(s).email,t=>e(s).email=t),fe(ae,()=>e(s).phone,t=>e(s).phone=t),fe(de,()=>e(s).enquiryDetails,t=>e(s).enquiryDetails=t),Ve(l,[],W,()=>e(s).preferredContact,t=>e(s).preferredContact=t),Ve(l,[],ne,()=>e(s).preferredContact,t=>e(s).preferredContact=t),fe(Ce,()=>e(s).message,t=>e(s).message=t),E(P,g),we({...xe()})}je(["click"]);z[k]="src/lib/components/ChatWidget.svelte";function yt(P,i,l,x){v(i,!e(i)),e(i)&&!e(l)&&x()}var xt=K(V('<button aria-label="Open chat"><svg class="w-8 h-8 svelte-569xhr" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" class="svelte-569xhr"></path></svg> <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse svelte-569xhr"></div></button>'),z[k],[[332,4,[[341,6,[[342,8]]],[345,6]]]]),_t=(P,i)=>v(i,!1),wt=K(V('<div class="flex justify-center svelte-569xhr"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 svelte-569xhr"></div></div>'),z[k],[[384,10,[[385,12]]]]),Ct=K(V('<div><div><div class="flex items-center space-x-2 svelte-569xhr"><div class="w-2 h-2 bg-green-400 rounded-full svelte-569xhr"></div> <span class="font-medium text-sm svelte-569xhr"> </span></div> <button class="hover:bg-black hover:bg-opacity-20 p-1 rounded svelte-569xhr" aria-label="Close chat"><svg class="w-5 h-5 svelte-569xhr" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-569xhr"></path></svg></button></div> <div class="px-3 py-2 bg-gray-50 border-b border-gray-200 svelte-569xhr"><p class="text-[10px] text-gray-600 text-center svelte-569xhr">AI-powered assistant. Not legal advice. Attorney review required.</p></div> <div class="flex-1 overflow-y-auto p-4 space-y-4 svelte-569xhr"><!> <!> <!> <!></div> <!></div>'),z[k],[[351,4,[[357,6,[[361,8,[[362,10],[363,10]]],[367,8,[[368,10,[[369,12]]]]]]],[375,6,[[376,8]]],[382,6]]]]),kt=K(V("<div><!> <!></div>"),z[k],[[329,0]]);function z(P,i){ye(new.target),_e(i,!0,z);let l=te(i,"tenantId",3,"11111111-1111-1111-1111-111111111111"),x=te(i,"position",3,"bottom-right"),s=te(i,"theme",3,"light"),w=A(q(!1),"isOpen"),d=A(q(!1),"isLoading"),T=A(q(!1),"isTyping"),F=A(q(null),"typingUser"),g=A(q(null),"tenant"),p=A(q(!1),"showContactForm"),b=A(q(Ie([])),"messages"),c=A(q(void 0),"socket"),y=A(q(!1),"mounted"),D=A(q(void 0),"messagesContainer"),S=A(q(!1),"isButtonAnimating"),R=A(q(!1),"hasPlayedSound"),I=A(q(0),"typingStartTime");nt(async()=>{v(y,!0),(await ve(Y()))(),setTimeout(()=>{ie(),ce()},3e3)}),st(()=>{e(c)&&e(c).disconnect()});async function Y(){if(o(typeof window,"undefined",!1)){const{io:n}=(await ve(Qe(()=>import("./CGD0v28n.js"),[],import.meta.url)))();v(c,n("/",{transports:["websocket","polling"]}),!0),e(c).on("connect",G),e(c).on("ai-response",ae),e(c).on("typing",re),e(c).on("contact-submitted",$),e(c).on("disconnect",N)}}async function j(){if(!(!e(y)||!e(c)))try{v(d,!0);const n=(await ve(fetch("/api/tenants/current",{headers:{"X-Tenant-Id":l()}})))();v(g,(await ve(n.json()))(),!0),e(c).emit("join-tenant",l());const m=(await ve(fetch("/api/ai/welcome",{headers:{"X-Tenant-Id":l()}})))(),_=(await ve(m.json()))(),H={id:`welcome_${Date.now()}`,content:_.response,sender:"ai",senderType:"bot",sentAt:new Date().toISOString(),tenantId:l(),metadata:_.metadata};v(b,[...e(b),H],!0),U()}catch(n){console.error(...Te("error","Chat initialization failed:",n))}finally{v(d,!1)}}function G(){console.log("Socket connected")}function N(){console.log("Socket disconnected")}function ae(n){const m=n.content.split(" ").length,_=Math.min(1500+m*50,4e3),C=Date.now()-e(I),M=Math.max(0,_-C);setTimeout(()=>{var t,f;v(T,!1),v(F,null),v(b,[...e(b),n],!0),U(),((t=n.metadata)!=null&&t.isDataCollection||(f=n.metadata)!=null&&f.shouldOfferConsultation)&&v(p,!0)},M)}function re(n){o(n.sender,"ai")&&(v(T,n.isTyping,!0),v(F,n.isTyping?"Legal Assistant":null,!0))}function $(n){n.success&&v(p,!1),console.log(...Te("log",n.message))}function U(){setTimeout(()=>{e(D)&&(e(D).scrollTop=e(D).scrollHeight)},100)}async function de(n){if(!e(c)||!n.trim())return;const m={id:`user_${Date.now()}`,content:n.trim(),sender:"user",senderType:"visitor",sentAt:new Date().toISOString(),tenantId:l()};v(b,[...e(b),m],!0),U(),setTimeout(()=>{v(T,!0),v(F,"Sarah"),v(I,Date.now(),!0),U()},3e3),e(c).emit("typing",{isTyping:!0,tenantId:l()});let _=e(b).slice(-10);e(c).emit("chat-message",{message:n.trim(),conversationHistory:_,tenantId:l()}),setTimeout(()=>{e(c).emit("typing",{isTyping:!1,tenantId:l()})},1e3)}async function se(n){if(!e(c))return;e(c).emit("submit-contact",{contactInfo:n,tenantId:l()});const m={id:`confirmation_${Date.now()}`,content:"Thank you for your information. An attorney will contact you shortly.",sender:"ai",senderType:"bot",sentAt:new Date().toISOString(),tenantId:l()};v(b,[...e(b),m],!0),v(p,!1),U()}function ie(){if(!(e(R)||e(w)))try{const n=new(window.AudioContext||window.webkitAudioContext),m=n.createOscillator(),_=n.createGain();m.connect(_),_.connect(n.destination),m.frequency.value=800,m.type="sine",_.gain.setValueAtTime(.3,n.currentTime),_.gain.exponentialRampToValueAtTime(.01,n.currentTime+.5),m.start(n.currentTime),m.stop(n.currentTime+.5),v(R,!0)}catch(n){console.log(...Te("log","Could not play notification sound:",n))}}function ce(){e(w)||(v(S,!0),setTimeout(()=>{v(S,!1)},2e3))}function ge(){const n=e(b).filter(M=>o(M.sender,"user")),m=["letter of demand","owes me money","accident","injury","divorce","contract","dispute","legal advice","sue","court","eviction","will","estate","custody","maintenance","debt","compensation","attorney","lawyer","consultation","legal help","legal assistance"],_=n.filter(M=>{const t=M.content.toLowerCase();return m.some(f=>t.includes(f))});let C=(_.length>0?_:n.slice(-1)).map(M=>M.content).join(". ");return C.length>200&&(C=C.substring(0,200)+"..."),C.toLowerCase().includes("letter of demand")?C=`Letter of Demand Request: ${C}`:C.toLowerCase().includes("accident")&&(C=`Accident Matter: ${C}`),C||"General legal enquiry"}let ue=A(He(()=>o(x(),"bottom-left")?"bottom-4 left-4":"bottom-4 right-4"),"positionClass");var W=kt(),le=a(W);{var ne=n=>{var m=xt();m.__click=[yt,w,g,j];let _;var H=a(m),C=a(H);Me(C,"stroke-width",2),r(H),pe(2),r(m),X(M=>{var t,f;_=O(m,1,`w-16 h-16 rounded-full shadow-lg flex items-center justify-center
             transition-all duration-300 hover:scale-110 text-white hover:shadow-xl
             ${e(S)?"attention-grabbing":""}`,"svelte-569xhr",_,M),De(m,(f=(t=e(g))==null?void 0:t.branding)!=null&&f.primaryColor?`background-color: ${e(g).branding.primaryColor}`:"")},[()=>{var M,t;return{"bg-blue-600":!((t=(M=e(g))==null?void 0:M.branding)!=null&&t.primaryColor)}}]),E(n,m)};L(()=>Z(le,n=>{e(w)||n(ne)}),"if",z,331,2)}var oe=u(le,2);{var Ce=n=>{var m=Ct();let _;var H=a(m);let C;var M=a(H),t=u(a(M),2),f=a(t,!0);r(t),r(M);var J=u(M,2);J.__click=[_t,w];var ze=a(J),Ge=a(ze);Me(Ge,"stroke-width",2),r(ze),r(J),r(H);var ke=u(H,4),Le=a(ke);{var Ye=h=>{var ee=wt();E(h,ee)};L(()=>Z(Le,h=>{e(d)&&h(Ye)}),"if",z,383,8)}var Be=u(Le,2);lt(()=>e(b),h=>h.id),L(()=>it(Be,17,()=>e(b),h=>h.id,(h,ee)=>{L(()=>be(h,{get message(){return e(ee)},get tenant(){return e(g)},get theme(){return s()}}),"component",z,390,10,{componentTag:"ChatMessage"})}),"each",z,389,8);var Ee=u(Be,2);{var Ue=h=>{{let ee=He(ge);L(()=>B(h,{onSubmit:se,onClose:()=>v(p,!1),get initialEnquiry(){return e(ee)}}),"component",z,395,10,{componentTag:"ContactForm"})}};L(()=>Z(Ee,h=>{e(p)&&h(Ue)}),"if",z,394,8)}var We=u(Ee,2);{var Xe=h=>{L(()=>Se(h,{get user(){return e(F)},get theme(){return s()}}),"component",z,403,10,{componentTag:"TypingIndicator"})};L(()=>Z(We,h=>{e(T)&&e(F)&&h(Xe)}),"if",z,402,8)}r(ke),Ke(ke,h=>v(D,h),()=>e(D));var Je=u(ke,2);L(()=>Ae(Je,{get disabled(){return e(d)},get theme(){return s()},placeholder:"Type your legal enquiry...",$$events:{send:h=>de(h.detail)}}),"component",z,408,6,{componentTag:"MessageInput"}),r(m),X((h,ee)=>{var Pe,Fe,Ne,Oe;_=O(m,1,"w-96 h-[32rem] bg-white rounded-lg shadow-2xl border flex flex-col overflow-hidden svelte-569xhr",null,_,h),C=O(H,1,"px-4 py-3 border-b flex items-center justify-between svelte-569xhr",null,C,ee),De(H,(Fe=(Pe=e(g))==null?void 0:Pe.branding)!=null&&Fe.primaryColor?`background-color: ${e(g).branding.primaryColor}`:""),Q(f,((Oe=(Ne=e(g))==null?void 0:Ne.branding)==null?void 0:Oe.companyName)||"Legal Assistant")},[()=>({"bg-gray-800":o(s(),"dark"),"border-gray-700":o(s(),"dark"),"border-gray-200":o(s(),"light")}),()=>{var h,ee;return{"bg-blue-600":!((ee=(h=e(g))==null?void 0:h.branding)!=null&&ee.primaryColor),"text-white":!0}}]),E(n,m)};L(()=>Z(oe,n=>{e(w)&&n(Ce)}),"if",z,350,2)}return r(W),X(()=>O(W,1,`fixed ${e(ue)??""} z-50`,"svelte-569xhr")),E(P,W),we({...xe()})}je(["click"]);export{z as default};
